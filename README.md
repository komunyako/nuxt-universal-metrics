# Набор для подключения метрик

## TODO
1. Сделать установочный пакет.
2. Добавить поддержку GTAG.
2. Написать нормальную доку.
3. Убрать срач в консоли.
4. Вынести хелперы в подключаемый модуль.
5. Написать развёрнутое универсальное АПИ.



## Установка
1. Скачать код и расположить его в папке `modules` в корне.
2. Подключить модуль в `nuxt.config.js`
```js
modules: [
    '@/modules/metrics/module'
],
```

3. Добавить настройки метрик.

Доступные метрики:
- Yandex = ym
- Google Analytics = ga
- Google Tag Manager = gtm

```js
metrics: {
    debug: false,
    ym: 'test',
    // Можно передавать несколько идентификаторов
    ym: [
        123,
        245
    ],
    ga: async(context) => {
        await new Promise((resolve) => {
            setTimeout(() => {
                resolve();
            }, 1000);
        });

        console.log(context);

        return 'ga_test';
    },
    gtm: () => {
        return 'TEST:myLayer';
    },
}
```

### Получение идентификаторов
Можно задавать идентификаторы строкой или числом, либо функцией которая вернёт эти форматы.
Функциональное получение полезно для обращения в АПИ. Первым параметром приходит контекст https://nuxtjs.org/docs/2.x/internals-glossary/context

`context.$axios` доступен для запросов к АПИ.

#### Имя слоя для GTM
Если требуется переназначить слой для метрики, нужно вернуть строку формата `ID:LAYER_NAME`. По умолчанию, слой называется `dataLayer`.

## Отправка целей
После инициализации в компонентах доступна переменная `$metrics`.
У неё есть методы: `goal` и `hit`.

Чтобы отправить цель по клику: `@click="$metrics.goal('YAY')"`. Если передана обычная строка, то будут подставлены дефолтные параметры для отправки. Так же можно передать объект, главное не забывать указать ВСЕ требуемые свойства.

`hit` скорее всего руками непонадобится вызывать, потому что он отрабаывает на изменение роута и отправляет во все метрики событие.

### Отправка целей в опеределённую метрику
Так же есть возможность обратиться к конкретному типу метрики `$metrics.$ym` `$metrics.$gtm` `$metrics.$ga`. Тут доступны такие же методы как и у родительского объекта.

А если совсем надо точно получить конкретный интерфейс метрики по идентификатору, то нужно вызвать метод `get` → `$metrics.get(ID)`. Можете сразу чейном вызывать метод `call` для прямого обращения к оригинальному объекту метрики → `$metrics.get(SOME_YANDEX_ID).call('reachGoal', {target: 'customMethodCall'})`.
